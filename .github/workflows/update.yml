name: Update Free Games

concurrency:
  group: github-pages
  cancel-in-progress: true

on:
  schedule:
    # ØªØ´ØºÙŠÙ„ ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª (ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 0ØŒ 6ØŒ 12ØŒ 18 UTC)
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        timeout-minutes: 5

      - name: Setup Python
        uses: actions/setup-python@v4
        timeout-minutes: 5
        with:
          python-version: '3.10'

      - name: Install dependencies
        timeout-minutes: 5
        run: |
          pip install -r requirements.txt

      - name: Run Steam script
        timeout-minutes: 10
        continue-on-error: true
        run: |
          echo "ğŸ® Ø¬Ù„Ø¨ Ø£Ù„Ø¹Ø§Ø¨ Steam..."
          python steam.py || echo "âš ï¸ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø£Ù„Ø¹Ø§Ø¨ Steam"

      - name: Run Epic script
        timeout-minutes: 10
        continue-on-error: true
        run: |
          echo "ğŸ® Ø¬Ù„Ø¨ Ø£Ù„Ø¹Ø§Ø¨ Epic..."
          python epic.py || echo "âš ï¸ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø£Ù„Ø¹Ø§Ø¨ Epic"

      - name: Update timestamp
        timeout-minutes: 2
        run: |
          echo "â° ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª..."
          python update_timestamp.py

      - name: Check for changes
        id: check_changes
        run: |
          if [[ -n $(git status --porcelain) ]]; then
            echo "changes=true" >> $GITHUB_OUTPUT
            echo "âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØºÙŠÙŠØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©"
          else
            echo "changes=false" >> $GITHUB_OUTPUT
            echo "â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©"
          fi

      - name: Commit and push changes
        if: steps.check_changes.outputs.changes == 'true'
        timeout-minutes: 5
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "ğŸ® ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ù„Ø¹Ø§Ø¨ - $(date +'%Y-%m-%d %H:%M:%S')"
          git push

      - name: No changes to commit
        if: steps.check_changes.outputs.changes == 'false'
        run: |
          echo "â„¹ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù„Ø¹Ø§Ø¨ Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø¯ÙŠØ«"
